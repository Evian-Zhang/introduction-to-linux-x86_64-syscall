<!DOCTYPE HTML>
<html lang="zh-Hans" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>stat, fstat, lstat, newfstatat, statx - Linux x86_64系统调用简介</title>
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        
        <link rel="icon" href="../../favicon.svg">
        
        
        <link rel="shortcut icon" href="../../favicon.png">
        
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        
        <link rel="stylesheet" href="../../css/print.css" media="print">
        

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="../../fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../../highlight.css">
        <link rel="stylesheet" href="../../tomorrow-night.css">
        <link rel="stylesheet" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded affix "><a href="../../index.html">序</a></li><li class="chapter-item expanded affix "><a href="../../src/introduction.html">基础知识</a></li><li class="chapter-item expanded affix "><li class="part-title">文件系统</li><li class="chapter-item expanded "><a href="../../src/filesystem/open-openat-name_to_handle_at-open_by_handle_at-open_tree.html"><strong aria-hidden="true">1.</strong> open, openat, name_to_handle_at, open_by_handle_at, open_tree</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/close.html"><strong aria-hidden="true">2.</strong> close</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/read-pread64-readv-preadv-preadv2.html"><strong aria-hidden="true">3.</strong> read, pread64, readv, preadv, preadv2</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/write-pwrite64-writev-pwritev-pwritev2.html"><strong aria-hidden="true">4.</strong> write, pwrite64, writev, pwritev, pwritev2</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/lseek.html"><strong aria-hidden="true">5.</strong> lseek</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/poll-select-pselect6-ppoll.html"><strong aria-hidden="true">6.</strong> poll, select, pselect6, ppoll</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/epoll_create-epoll_wait-epoll_ctl-epoll_pwait-epoll_create1.html"><strong aria-hidden="true">7.</strong> epoll_create, epoll_wait, epoll_ctl, epoll_pwait, epoll_create1</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/stat-fstat-lstat-newfstatat-statx.html" class="active"><strong aria-hidden="true">8.</strong> stat, fstat, lstat, newfstatat, statx</a></li><li class="chapter-item expanded "><a href="../../src/filesystem/eventfd-eventfd2.html"><strong aria-hidden="true">9.</strong> eventfd, eventfd2</a></li><li class="chapter-item expanded affix "><li class="part-title">内存管理</li><li class="chapter-item expanded "><a href="../../src/memory_management/mmap-munmap-mremap-msync-remap_file_pages.html"><strong aria-hidden="true">10.</strong> mmap, munmap, mremap, msync, remap_file_pages</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title">Linux x86_64系统调用简介</h1>

                    <div class="right-buttons">
                        
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="stat-fstat-lstat-newfstatat-statx系统调用"><a class="header" href="#stat-fstat-lstat-newfstatat-statx系统调用"><code>stat</code>, <code>fstat</code>, <code>lstat</code>, <code>newfstatat</code>, <code>statx</code>系统调用</a></h1>
<h2 id="stat-fstat-lstat与newfstatat"><a class="header" href="#stat-fstat-lstat与newfstatat"><code>stat</code>, <code>fstat</code>, <code>lstat</code>与<code>newfstatat</code></a></h2>
<h3 id="系统调用号"><a class="header" href="#系统调用号">系统调用号</a></h3>
<p><code>stat</code>为4，<code>fstat</code>为5，<code>lstat</code>为6，<code>newfstatat</code>为262。</p>
<h3 id="函数签名"><a class="header" href="#函数签名">函数签名</a></h3>
<h4 id="内核接口"><a class="header" href="#内核接口">内核接口</a></h4>
<pre><code class="language-c">asmlinkage long sys_newstat(const char __user *filename, struct stat __user *statbuf);
asmlinkage long sys_newfstat(unsigned int fd, struct stat __user *statbuf);
asmlinkage long sys_newlstat(const char __user *filename, struct stat __user *statbuf);
asmlinkage long sys_newfstatat(int dfd, const char __user *filename, struct stat __user *statbuf, int flag);
</code></pre>
<h4 id="glibc封装"><a class="header" href="#glibc封装">glibc封装</a></h4>
<p><code>stat</code>, <code>fstat</code>, <code>lstat</code>:</p>
<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
int stat(const char *pathname, struct stat *statbuf);
int fstat(int fd, struct stat *statbuf);
int lstat(const char *pathname, struct stat *statbuf);
</code></pre>
<p><code>newfstatat</code>:</p>
<pre><code class="language-c">#include &lt;fcntl.h&gt;
#include &lt;sys/stat.h&gt;
int fstatat(int dirfd, const char *pathname, struct stat *statbuf, int flags);
</code></pre>
<h3 id="简介"><a class="header" href="#简介">简介</a></h3>
<p>这四个系统调用都和文件的状态信息有关，也就是和<code>struct stat</code>这个结构体密切相关。首先，我们来看看其定义（该结构体在不同的指令集、内核版本中都不尽相同，该结构体为当前Linux内核版本下的x86_64版本）：</p>
<pre><code class="language-c">struct stat {
    dev_t st_dev;
    ino_t st_ino;
    nlink_t st_nlink;
    mode_t st_mode;
    uid_t st_uid;
    gid_t st_gid;
    dev_t st_rdev;
    off_t st_size;
    blksize_t st_blksize;
    blkcnt_t st_blocks;
#ifdef __USE_XOPEN2K8
    struct timespec st_atim;
    struct timespec st_mtim;
    struct timespec st_ctim;
#define st_atime st_atim.tv_sec
#define st_mtime st_mtim.tv_sec
#define st_ctime st_ctim.tv_sec
#else
    time_t st_atime;
    unsigned long st_atimensec;
    time_t st_mtime;
    unsigned long st_mtimensec;
    time_t st_ctime;
    unsigned long st_ctimensec;
#endif
};
</code></pre>
<p>其中每个字段的含义如下：</p>
<ul>
<li>
<p><code>st_dev</code>: 包含该文件的设备ID</p>
</li>
<li>
<p><code>st_ino</code>: inode数</p>
</li>
<li>
<p><code>st_nlink</code>: 该文件的硬链接数</p>
</li>
<li>
<p><code>st_mode</code>: 文件类型和模式。</p>
<ul>
<li>
<p>文件类型</p>
<p>通过与位掩码<code>S_IFMT</code>相与可得到相应的文件类型：</p>
<ul>
<li><code>S_IFSOCK</code>: 套接字文件</li>
<li><code>S_IFLINK</code>: 符号链接</li>
<li><code>S_IFREG</code>: 常规文件</li>
<li><code>S_IFBLK</code>: 块设备</li>
<li><code>S_IFDIR</code>: 目录</li>
<li><code>S_IFCHR</code>: 字符设备</li>
<li><code>S_IFOFO</code>: FIFO（管道）</li>
</ul>
</li>
<li>
<p>文件模式</p>
<p>通过与下列掩码相与可以得到相应的数据：</p>
<ul>
<li>
<p>特殊权限</p>
<ul>
<li>
<p><code>S_ISUID</code>: SUID位</p>
<p>在大部分情况下，如果将一个可执行的二进制程序的该位设为1，则运行该二进制程序产生的进程的euid与该文件的uid相同。该进程拥有该文件属主的权限。</p>
</li>
<li>
<p><code>S_ISGID</code>: SGID位</p>
<p>在大部分情况下，如果将一个可执行的二进制程序的该位设为1，则运行该二进制程序产生的进程的egid与该文件的gid相同。该进程拥有该文件属组的权限。</p>
<p>如果将一个目录的该位设为1，则表明在其中创建的所有文件的gid均与该目录相同，而不与创建该文件的进程的gid相同。</p>
</li>
<li>
<p><code>S_ISVTX</code>: Sticky位</p>
<p>如果将一个目录的该位设为1，则该目录中所有文件只能被该文件的属主、该目录的属主以及特权进程重命名或删除。</p>
</li>
</ul>
</li>
<li>
<p>所有者权限</p>
<ul>
<li><code>S_IRWXU</code>: 属主拥有读、写、执行权限</li>
<li><code>S_IRUSR</code>: 属主拥有读权限</li>
<li><code>S_IWUSR</code>: 属主拥有写权限</li>
<li><code>S_IXUSR</code>: 属主拥有执行权限</li>
</ul>
</li>
<li>
<p>用户组权限</p>
<ul>
<li><code>S_IRWXG</code>: 属组拥有读、写、执行权限</li>
<li><code>S_IRGRP</code>: 属组拥有读权限</li>
<li><code>S_IWGRP</code>: 属组拥有写权限</li>
<li><code>S_IXGRP</code>: 属组拥有执行权限</li>
</ul>
</li>
<li>
<p>其它用户权限</p>
<ul>
<li><code>S_IRWXO</code>: 他人拥有读、写、执行权限</li>
<li><code>S_IROTH</code>: 他人拥有读权限</li>
<li><code>S_IWOTH</code>: 他人拥有写权限</li>
<li><code>S_IXOTH</code>: 他人拥有执行权限</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code>st_uid</code>: 该文件的uid</p>
</li>
<li>
<p><code>st_gid</code>: 该文件的gid</p>
</li>
<li>
<p><code>st_rdev</code>: 如果该文件表示一个设备，则为该文件所表示的设备ID</p>
</li>
<li>
<p><code>st_size</code>: 文件大小（以字节计）</p>
<p>如果该文件是一个符号链接，则表示其链接的源路径对应的字符串长度</p>
</li>
<li>
<p><code>st_blksize</code>: 使用高效文件IO时，推荐使用的块大小</p>
</li>
<li>
<p><code>st_blocks</code>: 分配给该文件的块数目（以512字节为一个单位）</p>
</li>
<li>
<p>时间戳</p>
<ul>
<li>
<p>首先，各个名称的意义：</p>
<ul>
<li><code>atime</code>: 最后访问时间</li>
<li><code>mtime</code>: 最后修改时间</li>
<li><code>ctime</code>: 文件状态最后修改时间</li>
<li><code>mtime</code>与<code>ctime</code>的区别在于，前者是文件内容的修改，而后者则是文件对应inode的修改。如只修改<code>st_atime</code>字段，而不修改文件内容，则<code>mtime</code>不变，<code>ctime</code>发生改变。</li>
</ul>
</li>
<li>
<p>如果：</p>
<ul>
<li><code>_POSIX_C_SOURCE</code>宏定义为不小于200809L的值</li>
<li><code>_XOPEN_SOURCE</code>定义为不小于700的值</li>
<li><code>_BSD_SOURCE</code>被定义</li>
<li><code>_SVID_SOURCE</code>被定义</li>
</ul>
<p>上述条件只需要满足任意一个，我们就可以通过<code>st_atime</code>或<code>st_atim.tv_sec</code>访问UNIX时间戳（以秒为单位），<code>st_atime.tv_nsec</code>访问其纳秒部分（不是总时长，而是除去秒部分，剩下的纳秒部分的大小）。其余几个时间也可以用类似的方式访问秒和纳秒部分。</p>
</li>
<li>
<p>如果上面的条件都不满足，我们则可以通过<code>st_atime</code>访问UNIX时间戳（以秒为单位），<code>st_atimensec</code>访问其纳秒部分。</p>
</li>
<li>
<p>也就是说，无论何种情况，我们都可以用<code>st_atime</code>访问以秒为单位的UNIX时间戳。</p>
</li>
</ul>
</li>
</ul>
<p><code>stat</code>是根据文件路径获得相应的文件状态信息，但如果文件是一个符号链接，则会获得其指向的实际文件的信息。</p>
<p><code>lstat</code>也是根据文件路径获得相应的文件信息，但如果文件是一个符号链接，则会获得链接本身的状态信息。</p>
<p><code>fstat</code>是根据文件描述符获得相应的文件信息，行为和<code>stat</code>相同。</p>
<p><code>fstatat</code>则是一个更普遍的接口，可以提供<code>stat</code>, <code>lstat</code>, <code>fstat</code>的功能。首先，<code>dirfd</code>与<code>pathname</code>的用法与<code>openat</code>相同，既可以用于绝对路径，也可以用于相对特定目录的相对路径，也可以用于相对当前目录的相对路径。其次，对于<code>flags</code>，其主要的标志位的功能有：</p>
<ul>
<li>如果包含<code>AT_EMPTY_PATH</code>标志位，且<code>filename</code>是空字符串，则获得<code>dirfd</code>句柄对应的文件的状态信息。此时<code>dirfd</code>可以是任何文件类型，而不一定是目录。这种行为类似<code>fstat</code>。</li>
<li>如果包含<code>AT_SYMLINK_NOFOLLOW</code>标志位，且<code>dirfd</code>和<code>filename</code>组成的路径是一个符号链接，则获得链接本身的状态信息（相当于<code>lstat</code>）；如果不包含该标志位，则获得链接指向的实际文件的信息（相当于<code>stat</code>）。</li>
</ul>
<h3 id="实现"><a class="header" href="#实现">实现</a></h3>
<p>这四个系统调用的实现均位于<code>fs/stat.c</code>中。其实现的核心为位于<code>fs/stat.c</code>中的<code>vfs_getattr_nosec</code>函数：</p>
<pre><code class="language-c">int vfs_getattr_nosec(const struct path *path, struct kstat *stat, u32 request_mask, unsigned int query_flags)
{
	struct inode *inode = d_backing_inode(path-&gt;dentry);

	memset(stat, 0, sizeof(*stat));
	stat-&gt;result_mask |= STATX_BASIC_STATS;
	request_mask &amp;= STATX_ALL;
	query_flags &amp;= KSTAT_QUERY_FLAGS;

	/* allow the fs to override these if it really wants to */
	if (IS_NOATIME(inode))
		stat-&gt;result_mask &amp;= ~STATX_ATIME;
	if (IS_AUTOMOUNT(inode))
		stat-&gt;attributes |= STATX_ATTR_AUTOMOUNT;

	if (inode-&gt;i_op-&gt;getattr)
		return inode-&gt;i_op-&gt;getattr(path, stat, request_mask,
					    query_flags);

	generic_fillattr(inode, stat);
	return 0;
}
</code></pre>
<p>我们可以看到，其最关键的就在于<code>inode-&gt;i_op-&gt;getattr</code>。因此，其和<code>read</code>, <code>write</code>类似，也是通过函数指针实现多态的方式，获得相应的状态。</p>
<h2 id="statx"><a class="header" href="#statx"><code>statx</code></a></h2>
<h3 id="系统调用号-1"><a class="header" href="#系统调用号-1">系统调用号</a></h3>
<p>332</p>
<h3 id="函数签名-1"><a class="header" href="#函数签名-1">函数签名</a></h3>
<h4 id="内核接口-1"><a class="header" href="#内核接口-1">内核接口</a></h4>
<pre><code class="language-c">asmlinkage long sys_statx(int dfd, const char __user *path, unsigned flags, unsigned mask, struct statx __user *buffer);
</code></pre>
<h4 id="glibc封装-1"><a class="header" href="#glibc封装-1">glibc封装</a></h4>
<pre><code class="language-c">#include &lt;sys/types.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;unistd.h&gt;
#include &lt;fcntl.h&gt;
int statx(int dirfd, const char *pathname, int flags, unsigned int mask, struct statx *statxbuf);
</code></pre>
<p>上述头文件是在<code>statx</code>的man手册里写的，但实际使用时似乎还应该包含<code>linux/stat.h</code>头文件。</p>
<h3 id="简介-1"><a class="header" href="#简介-1">简介</a></h3>
<p>该系统调用的功能类似与<code>newfstatat</code>，但是，其提供的信息的类型是<code>struct statx</code>而不是<code>struct stat</code>，其包含的信息更多。</p>
<p>使用该函数的方式与<code>fstatat</code>类似，其中<code>mask</code>表示的是用户感兴趣的字段。也就是说，我们可以通过<code>mask</code>让返回的<code>statxbuf</code>只有部分字段有意义，其余不感兴趣的字段不需要内核来填充。其提供的标志位包括：</p>
<ul>
<li><code>STATX_TYPE</code>: 得到<code>stx_mode &amp; S_IFMT</code></li>
<li><code>STATX_MODE</code>: 得到<code>stx_mode &amp; ~S_IFMT</code></li>
<li><code>STATX_NLINK</code>: 得到<code>stx_nlink</code></li>
<li><code>STATX_UID</code>: 得到<code>stx_uid</code></li>
<li><code>STATX_GID</code>: 得到<code>stx_gid</code></li>
<li><code>STATX_ATIME</code>: 得到<code>stx_atime</code></li>
<li><code>STATX_MTIME</code>: 得到<code>stx_mtime</code></li>
<li><code>STATX_CTIME</code>: 得到<code>stx_ctime</code></li>
<li><code>STATX_INO</code>: 得到<code>stx_ino</code></li>
<li><code>STATX_SIZE</code>: 得到<code>stx_size</code></li>
<li><code>STATX_BLOCKS</code>: 得到<code>stx_blocks</code></li>
<li><code>STATX_BASIC_STATS</code>: 得到上述全部</li>
<li><code>STATX_BTIME</code>: 得到<code>stx_btime</code></li>
<li><code>STATX_ALL</code>: 得到所有的字段</li>
</ul>
<p>该结构体的内容是：</p>
<pre><code class="language-c">struct statx {
	__u32	stx_mask;	/* What results were written [uncond] */
	__u32	stx_blksize;	/* Preferred general I/O size [uncond] */
	__u64	stx_attributes;	/* Flags conveying information about the file [uncond] */
	__u32	stx_nlink;	/* Number of hard links */
	__u32	stx_uid;	/* User ID of owner */
	__u32	stx_gid;	/* Group ID of owner */
	__u16	stx_mode;	/* File mode */
	__u16	__spare0[1];
	__u64	stx_ino;	/* Inode number */
	__u64	stx_size;	/* File size */
	__u64	stx_blocks;	/* Number of 512-byte blocks allocated */
	__u64	stx_attributes_mask; /* Mask to show what's supported in stx_attributes */
	struct statx_timestamp	stx_atime;	/* Last access time */
	struct statx_timestamp	stx_btime;	/* File creation time */
	struct statx_timestamp	stx_ctime;	/* Last attribute change time */
	struct statx_timestamp	stx_mtime;	/* Last data modification time */
	__u32	stx_rdev_major;	/* Device ID of special file [if bdev/cdev] */
	__u32	stx_rdev_minor;
	__u32	stx_dev_major;	/* ID of device containing file [uncond] */
	__u32	stx_dev_minor;
	__u64	__spare2[14];	/* Spare space for future expansion */
};
</code></pre>
<p>其与<code>struct stat</code>的主要区别在于：</p>
<ul>
<li><code>stx_mask</code>: 即传入的<code>mask</code>参数，表示哪些字段有意义</li>
<li><code>stx_attributes</code>: 该文件更多的状态信息。其主要包含如下标志位：
<ul>
<li><code>STATX_ATTR_IMMUTABLE</code>: 该文件不能被修改</li>
<li><code>STATX_ATTR_APPEND</code>: 该文件只能以append模式写入，也就是说每次写入都必须在文件最后</li>
<li><code>STATX_ATTR_DAX</code>: 该文件处于DAX状态（CPU直接访问）。TODO：进一步解释</li>
</ul>
</li>
<li><code>stx_attributes_mask</code>: 掩码，用于表示<code>stx_attributes</code>的哪些标志位被设置了（有可能有的标志位没有被操作系统设置，而不是没有包含该标志位）</li>
</ul>
<h3 id="实现-1"><a class="header" href="#实现-1">实现</a></h3>
<p>其实现与<code>stat</code>等系统调用相同。内核会根据系统调用的类型，确定一个内部的掩码，根据掩码获得相应的文件信息。</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        
                            <a rel="prev" href="../../src/filesystem/epoll_create-epoll_wait-epoll_ctl-epoll_pwait-epoll_create1.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>
                        

                        
                            <a rel="next" href="../../src/filesystem/eventfd-eventfd2.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>
                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                
                    <a rel="prev" href="../../src/filesystem/epoll_create-epoll_wait-epoll_ctl-epoll_pwait-epoll_create1.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>
                

                
                    <a rel="next" href="../../src/filesystem/eventfd-eventfd2.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="../../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="../../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        

    </body>
</html>
